version: "1"
projects:
- name: tp
  environments:
  - name: Production
    databases:
    - name: tp-db
      databaseName: tp
      user: tp
      plan: free
      region: frankfurt
      ipAllowList:
      - source: 0.0.0.0/0
        description: everywhere
      postgresMajorVersion: "17"
    services:
    - type: web
      name: tp07_lesecq_charles
      runtime: static
      repo: https://github.com/clesecq/tp07_lesecq_charles
      buildCommand: pnpm install && pnpm build
      staticPublishPath: dist/tp/browser
      routes:
      - type: rewrite
        source: /*
        destination: /index.html
      autoDeployTrigger: commit
      rootDir: front
    - type: web
      name: tp_api_lesecq_charles
      runtime: node
      repo: https://github.com/clesecq/tp06_lesecq_charles
      plan: free
      envVars:
      - key: DB_USER
        fromService:
          name: tp-db
          property: user
      - key: DB_PORT
        fromService:
          name: tp-db
          property: port
      - key: DB_PASSWORD
        fromService:
          name: tp-db
          property: password
      - key: DB_NAME
        fromService:
          name: tp-db
          property: databaseName
      - key: DB_HOST
        fromService:
          name: tp-db
          property: host
      - key: ACCESS_TOKEN_SECRET
        generateValue: true
      region: frankfurt
      buildCommand: pnpm install && pnpm build
      startCommand: pnpm start
      autoDeployTrigger: commit
      rootDir: api

